<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer form</title>

    <!--    font-awesome-->
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
          integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
          referrerpolicy="no-referrer" rel="stylesheet"/>

    <!--    viewport-->
    <meta content="width=device-width initial-scale=1" name="viewport">

    <!--    bootstrap-->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">

    <link href="../assets/css/style.css" rel="stylesheet">

    <style>

        /*.btn-success {*/
        /*    border: none;*/
        /*}*/

    </style>

</head>


<body class="container-fluid">


<!--header-->
<section class="row">

    <nav class="navbar navbar-expand-lg " style="background-color: #4e4eff">
        <div class="container-fluid">
            <!--            <a class="navbar-brand" href="#">Navbar</a>-->
            <a class="navbar-brand" href="#">
                <img alt="Logo" class="d-inline-block align-text-top" height="30" src="../assets/img/user.png"
                     width="30">
                POS SYSTEM
            </a>
            <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
                    class="navbar-toggler" data-bs-target="#navbarSupportedContent"
                    data-bs-toggle="collapse" type="button">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="justify-content-end collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav justify-content-center nav-tabs">
                    <li class="nav-item">
                        <a aria-current="page" class="nav-link" href="../dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="customer.html">Customer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="item.html">Item</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Order</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="placeOrder.html">Place Order</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

</section>

<!--content-->
<section class="row bg-light">
    <section class=" col-12 col-lg-4 d-flex align-items-center justify-content-center" style="margin-top: 50px">

        <div class="w-75">
            <div style="background: darkgoldenrod; height: 50px; margin-bottom: 30px">
                <h5 style="text-align: center; font-weight: bold; border-radius: 5px; color: black; padding-top: 10px ">
                    Add New Customer</h5>
            </div>

            <div class="mb-3">
                <label class="form-label" for="txtCustomerId">Customer ID</label>
                <input class="form-control" id="txtCustomerId" placeholder="C00-001" type="text">
                <span style="font-size: 12px; color: red"></span>
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtCustomerName">Customer Name</label>
                <input class="form-control" id="txtCustomerName" placeholder="Nimal Perera" type="text">
                <span style="font-size: 12px; color: red"></span>
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtCustomerAddress">Customer Address</label>
                <input class="form-control" id="txtCustomerAddress" placeholder="22/6 Kandy RD, Negombo"
                       type="text">
                <span style="font-size: 12px; color: red"></span>
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtCustomerSalary">Customer Salary</label>
                <input class="form-control" id="txtCustomerSalary" placeholder="100000.00" type="number">
                <span style="font-size: 12px; color: red"></span>
            </div>

            <div style="display: flex; align-items: flex-end; justify-content: right">
                <button class="btn btn-warning w-25" id="btnClear" style="margin: 5px" type="button">Clear</button>
                <button class="btn btn-success w-25" id="btnSave" style="margin: 5px" type="button">Save</button>
            </div>
        </div>
    </section>

    <section class="col-12 col-lg-8">

        <form class="row g-3">
            <div class="col-auto w-50" style="margin-top: 70px">
                <label class="visually-hidden" for="inputPassword2">Password</label>
                <input class="form-control" id="inputPassword2" placeholder="search" type="text">
            </div>
            <div class="col-auto" style="margin-top: 70px">
                <button class="btn btn-primary mb-3" type="submit">Search</button>
            </div>
        </form>

        <aside class="scrollable">

            <table class="table table-hover table-striped">
                <thead class="table-dark sticky-top">
                <tr>
                    <th scope="col">Customer ID</th>
                    <th scope="col">Name</th>
                    <th scope="col">Address</th>
                    <th scope="col">Salary</th>
                    <th scope="col">Operate</th>
                </tr>
                </thead>
                <tbody class="table table-hover table-striped sticky" id="tblCustomer">
                </tbody>
            </table>


        </aside>

    </section>
</section>


<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery-3.6.1.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>


    $('#txtCustomerId, #txtCustomerName, #txtCustomerAddress, #txtCustomerSalary').on('keyup', function () {
        checkValidity();
    });


    // customer regex
    const cusIDRegEx = /^(C00-)[0-9]{3}$/;
    const cusNameRegEx = /^[A-z ]{3,20}$/;
    const cusAddressRegEx = /^[0-9/A-z. ,]{5,}$/;
    const cusSalaryRegEx = /^[0-9]{1,}[.]?[0-9]{2}$/;

    let customerValidations = [];
    let c = {
        reg: cusIDRegEx,
        field: $('#txtCustomerId'),
        error: 'CustomerId pattern is wrong! ex: C00-001'
    }
    customerValidations.push(c);
    customerValidations.push({
        reg: cusNameRegEx,
        field: $('#txtCustomerName'),
        error: 'CustomerName pattern is wrong! ex: A-z (3-20)'
    });
    customerValidations.push({
        reg: cusAddressRegEx,
        field: $('#txtCustomerAddress'),
        error: 'CustomerAddress pattern is wrong! ex: A-z (0-9., /)'
    });
    customerValidations.push({
        reg: cusSalaryRegEx,
        field: $('#txtCustomerSalary'),
        error: 'CustomerSalary pattern is wrong! ex: 100 or 100.00'
    });


    function checkValidity() {
        for (let validation of customerValidations) {
            if (check(validation.reg, validation.field)) {
                testSuccess(validation.field, "");
            } else {
                setError(validation.field, validation.error);
            }
        }
    }

    function check(regex, textField) {
        let inputValue = textField.val();
        // console.log(regex.test(inputValue));
        return regex.test(inputValue);
    }

    function testSuccess(textField, msg) {
        if (textField.val().length <= 0) {
            textField.css('border', '1px solid #ced4da');
            textField.parent().children('span').text("");
        } else {
            textField.css('border', '3px solid lightgreen');
            textField.parent().children('span').text(msg);
        }
    }

    function setError(textField, msg) {
        if (textField.val().length <= 0) {
            textField.css('border', '1px solid #ced4da');
            textField.parent().children('span').text("");
        } else {
            textField.css('border', '3px solid red');
            textField.parent().children('span').text(msg);
        }
    }


    // customer array
    var cusArray = [];
    $('#btnSave').on('click', function () {

        let textOfButton = $('#btnSave').text();
        // save customer
        if (textOfButton == 'Save') {
            let customerId = $('#txtCustomerId').val();
            let customerName = $('#txtCustomerName').val();
            let customerAddress = $('#txtCustomerAddress').val();
            let customerSalary = $('#txtCustomerSalary').val();

            var customer = {
                id: customerId,
                name: customerName,
                address: customerAddress,
                salary: customerSalary
            }

            // let ok = confirm('Do you want to add this customer!');
            // if (ok){
            //     cusArray.push(customer);
            // }

            ///////

            swal({
                title: "Are you sure?",
                text: "Do you really want to add this customer!",
                icon: "warning",
                buttons: true,
                // dangerMode: true,
            })
                .then((willAdd) => {
                    if (willAdd) {
                        cusArray.push(customer);
                        loadAllCustomers();
                        swal("Poof! Your imaginary file has been added!", {
                            icon: "success",
                        });
                    }
                });


        } else {

            // update customer
            cusArray[indexNo].id = $('#txtCustomerId').val();
            cusArray[indexNo].name = $('#txtCustomerName').val();
            cusArray[indexNo].address = $('#txtCustomerAddress').val();
            cusArray[indexNo].salary = $('#txtCustomerSalary').val();
            $('#btnSave').text('Save');
            loadAllCustomers();

        }


        clearTextFields();

    });

    function loadAllCustomers() {
        $('#tblCustomer').empty();

        for (var i of cusArray) {
            var row = "<tr><td>" + i.id + "</td><td>" + i.name + "</td><td>" + i.address + "</td><td>" + i.salary + "</td><td class='operate'>\n" +
                "                        <div class=\"d-flex justify-content-center\" style=\"padding: 0; margin: 0;\">\n" +
                "                            <div aria-label=\"Basic mixed styles example\" class=\"btn-group btn-group-sm\" role=\"group\"\n" +
                "                                 style=\"padding: 0\">\n" +
                "                                <button class=\"btn btn-warning btnEdit\" type=\"button\" id='btnEdit'>Edit</button>\n" +
                "                                <button class=\"btn btn-danger\" type=\"button\" id='btnDelete'>Delete</button>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                    </td></tr>"
            $('#tblCustomer').append(row);
        }

    }

    // press tab key
    $('#txtCustomerId, #txtCustomerName, #txtCustomerAddress, #txtCustomerSalary').on('keydown', function (event) {
        if (event.key == 'Tab') {
            event.preventDefault();
        }
    });

    $('#txtCustomerId').keydown(function (event) {
        if (event.key == 'Enter' && check(cusIDRegEx, $('#txtCustomerId'))) {
            var option = searchCustomer($('#txtCustomerId').val());
            if (option == null) {
                $('#txtCustomerName').focus();
            }
        } else {
            $('#txtCustomerId').focus();
        }
    });

    $('#txtCustomerName').keydown(function (event) {
        if (event.key == 'Enter' && check(cusNameRegEx, $('#txtCustomerName'))) {
            $('#txtCustomerAddress').focus();
        }
    });

    $('#txtCustomerAddress').keydown(function (event) {
        if (event.key == 'Enter' && check(cusAddressRegEx, $('#txtCustomerAddress'))) {
            $('#txtCustomerSalary').focus();
        }
    });

    // clear button
    $('#btnClear').click(function () {
        clearTextFields();
        $('#btnSave').text('Save');
    });

    function clearTextFields() {
        $('#txtCustomerId, #txtCustomerName, #txtCustomerAddress, #txtCustomerSalary').val("");
        getDefault();
    }

    // edit button
    $('#tblCustomer').on('click', '#btnEdit', function () {
        var cusID = searchCustomer($(this).parents('tr').children(':first-child').text());
        $('#btnSave').text('Update');
        findIndexNumber(cusID);
        getDefault();
    });

    // hide span text and get default border color
    function getDefault() {
        $('#txtCustomerId, #txtCustomerName, #txtCustomerAddress, #txtCustomerSalary').parent().children('span').text("");
        $('#txtCustomerId, #txtCustomerName, #txtCustomerAddress, #txtCustomerSalary').css('border', '1px solid #CED4DA');
    }


    let indexNo = "";

    function findIndexNumber(cusID) {
        console.log(cusArray.indexOf(cusID));
        indexNo = cusArray.indexOf(cusID);
    }

    // delete customer using delete button
    $('#tblCustomer').on('click', '#btnDelete', function () {
        let cusID = $(this).parents('tr').children(':first-child').text();
        let indexNumber = cusArray.indexOf(cusID);
        cusArray.splice(indexNumber, 1);
        loadAllCustomers();

        clearTextFields();
        $('#btnSave').text('Save');
    });

    // search customer
    function searchCustomer(cusId) {
        for (var i of cusArray) {
            if (i.id == cusId) {
                setTextFieldValues(i.id, i.name, i.address, i.salary);
                return i;
            }
        }
        return null;
    }

    function setTextFieldValues(id, name, address, salary) {
        $('#txtCustomerId').val(id);
        $('#txtCustomerName').val(name);
        $('#txtCustomerAddress').val(address);
        $('#txtCustomerSalary').val(salary);
    }


</script>

</body>
</html>