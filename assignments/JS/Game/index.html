<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NINJA</title>

    <link href="assets/css/style.css" rel="stylesheet">
</head>

<body class="body" onkeydown="keyCheck(event)" onload="idleAnimationStart(); createBarrier();">
<div id="background">

    <img alt="character" class="ninja" id="ninja" src="assets/img/Idle__000.png">

    <div id="score">0</div>

    <div id="gameOver">
        <div style="color: yellow" class="endScore">Your Score</div>
        <div style="color: yellow" id="endScore">0</div>
        <img id="btnTryAgain" src="assets/img/refresh.png" alt="restart">
    </div>

</div>

<script src="assets/js/jquery-3.6.1.min.js"></script>
<script>

    var ninja = $('.ninja');

    var idleImageNum = 1;
    var idleAnimationNum = 0;

    function idleAnimation() {
        ninja.attr("src", "assets/img/Idle__00" + idleImageNum + ".png");
        idleImageNum += 1;

        if (idleImageNum == 10) {
            idleImageNum = 1;
        }
    }

    function idleAnimationStart() {
        idleAnimationNum = setInterval(idleAnimation, 100);
    }


    var runImageNum = 1;
    var runAnimationNum = 0;

    function runAnimation() {
        ninja.attr("src", "assets/img/Run__00" + runImageNum + ".png").css({width: "13%", bottom: "0px"});
        runImageNum += 1;
        runSound.play();

        if (runImageNum == 10) {
            runImageNum = 1;
        }
    }

    function runAnimationStart() {
        runAnimationNum = setInterval(runAnimation, 100);
        clearInterval(idleAnimationNum);
    }

    function keyCheck(event) {
        var keyCode = event.which;

        if (keyCode == 39) {
            if (runAnimationNum == 0) {
                runAnimationStart();
            }

            if (moveBackgroundAnimationId == 0) {
                moveBackgroundAnimationId = setInterval(moveBackground, 100);
            }

            if (barrierAnimationId == 0) {
                barrierAnimationId = setInterval(barrierAnimation, 100);
            }
        }

        if (keyCode == 38) {
            if (jumpAnimationNum == 0) {
                jumpAnimationStart();
            }

            if (moveBackgroundAnimationId == 0) {
                moveBackgroundAnimationId = setInterval(moveBackground, 100);
            }

            if (barrierAnimationId == 0) {
                barrierAnimationId = setInterval(barrierAnimation, 100);
            }
        }

    }


    var backgroundImagePositionX = 0;
    var moveBackgroundAnimationId = 0;
    var score = 0;

    function moveBackground() {
        backgroundImagePositionX -= 20;

        $('#background').css("backgroundPositionX", backgroundImagePositionX + "px");
        score += 1;
        $('#score').text(score);
    }

    var jumpImageNum = -1;
    var jumpAnimationNum = 0;
    var ninjaMarginTop = 0;

    function jumpAnimation() {
        ninja.attr("src", "assets/img/Jump__00" + jumpImageNum + ".png").css({width: "13%", top: "-200px"});
        jumpImageNum = jumpImageNum + 1;
        ninjaMarginTop += 10;
        jumpSound.play();
        runSound.pause();

        if (jumpImageNum == 10) {
            jumpImageNum = 1;
            clearInterval(jumpAnimationNum);
            jumpAnimationNum = 0;
            runImageNum = 0;
            runAnimationStart();
            ninja.css("top", "-2px");
            ninjaMarginTop = 0;
        }
    }

    function jumpAnimationStart() {
        clearInterval(idleAnimationNum);
        runImageNum = 0;
        clearInterval(runAnimationNum);
        jumpAnimationNum = setInterval(jumpAnimation, 100);
    }

    var barrierMarginLeft = 2000;

    function createBarrier() {

        for (var i = 0; i < 50; i++) {
            var box = document.createElement("div");
            box.className = "barrier";
            document.getElementById("background").appendChild(box);
            box.style.marginLeft = barrierMarginLeft + "px";
            box.id = "box" + i;

            if (i <= 25) {
                barrierMarginLeft = barrierMarginLeft + 1500;
            }

            if (i > 25) {
                barrierMarginLeft = barrierMarginLeft + 1000;
            }

        }
    }

    var barrierAnimationId = 0;

    function barrierAnimation() {
        for (var i = 0; i < 50; i++) {
            var box = document.getElementById("box" + i);
            var currentMarginLeft = getComputedStyle(box).marginLeft;
            var newMarginLeft = parseInt(currentMarginLeft) - 35;
            box.style.marginLeft = newMarginLeft + "px";


            if (newMarginLeft >= 0 & newMarginLeft <= 122) {
                if (ninjaMarginTop == 0) {
                    clearInterval(barrierAnimationId);

                    clearInterval(runAnimationNum);
                    runAnimationNum = -1;
                    clearInterval(jumpAnimationNum);
                    jumpAnimationNum = -1;
                    clearInterval(moveBackgroundAnimationId);
                    moveBackgroundAnimationId = -1;

                    deadAnimationNum = setInterval(deadAnimation, 100);
                }
            }
        }
    }

    var deadImageNum = 0;
    var deadAnimationNum = 0;

    function deadAnimation() {
        $('.ninja').attr("src", "assets/img/Dead__00" + deadImageNum + ".png");
        deadImageNum += 1;
        runSound.pause();
        jumpSound.pause();

        if (deadImageNum == 10) {
            deadImageNum = 9;
            $('.ninja').css('bottom','0');
            $('#gameOver').css('visibility', 'visible');
            $('#endScore').text(score);
            $('.barrier').css('visibility', 'hidden');

        }
    }

    $('#btnTryAgain').click(function (){
        reload();
    });

    function reload(){
        location.reload();
    }

    var runSound = new Audio("assets/audio/run.wav");
    var jumpSound = new Audio("assets/audio/jump.mp3");

    runSound.loop = true;
    runSound.playbackRate = 0.7;
    // runSound.currentTime = 0.1;

</script>
</body>
</html>